<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>React Native Amap Geolocation</title>
	<meta name="description" content="Documentation for React Native Amap Geolocation">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">React Native Amap Geolocation</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>React Native Amap Geolocation</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#uiwreact-native-amap-geolocation" id="uiwreact-native-amap-geolocation" style="color: inherit; text-decoration: none;">
					<h2>@uiw/react-native-amap-geolocation</h2>
				</a>
				<p><a href="https://npmjs.org/package/@uiw/react-native-amap-geolocation"><img src="https://img.shields.io/npm/v/@uiw/react-native-amap-geolocation.svg" alt="NPM Version"></a>
				<img src="https://img.shields.io/david/peer/uiwjs/react-native-amap-geolocation" alt="David"></p>
				<p>React Native 高德地图定位模块，支持 Android/iOS。提供尽可能完善的原生接口，同时提供符合 Web 标准的 Geolocation API 以及 <a href="https://uiwjs.github.io/react-native-amap-geolocation/">完整的接口文档</a>。</p>
				<a href="#注意事项" id="注意事项" style="color: inherit; text-decoration: none;">
					<h2>注意事项</h2>
				</a>
				<p>⚠️ 高德地图定位部分 API 需要真机调试和 <code>Access WiFi Information</code> 权限。</p>
				<details>
					<summary>Android：需要正确的设置 apiKey，获取 Key 的方法</summary>
					<br />
					<p>官方获取 Key方法：<a href="https://lbs.amap.com/api/android-location-sdk/guide/create-project/get-key">https://lbs.amap.com/api/android-location-sdk/guide/create-project/get-key</a></p>
					<p>A. 使用 <code>keytool</code>（jdk自带工具）获取 <code>SHA1</code>，默认 测试版本 <code>keystore</code> 路径 <code>&lt;项目名称&gt;/android/app/debug.keystore</code></p>
					<pre><code class="language-bash">keytool -v -list -keystore  keystore文件路径</code></pre>
					<p>B. 获取 <code>PackageName</code>，获取路径 <code>&lt;项目名称&gt;/android/app/src/main/AndroidManifest.xml</code></p>
					<p>C. 在高德地图账号中设置 <code>SHA1</code> 和 <code>PackageName</code>。</p>
					<img src="https://raw.githubusercontent.com/uiwjs/react-native-amap-geolocation/master/imgs/sha1.png" />
					<p>D. 按照上面步骤正确设置你的 <code>apiKey</code> 才会起作用。</p>
				</details>
				<details>
					<summary>Android：无法获取逆地理信息的问题，KEY鉴权失败</summary>
					<ol>
						<li>APK 当前签名文件的 SHA1 与<a href="https://console.amap.com/">高德开放平台</a>中设置不一致</li>
						<li>Android Studio 开发者请注意调整 <code>build.gradle</code> 文件的 <code>applicationId</code> 与 <code>packageName</code> 一致，如不一致将会导致鉴权失败。</li>
						<li>工程中的 <code>packageName</code> 与<a href="https://console.amap.com/">高德开放平台</a>中 <code>packageName</code> 设置不一致</li>
						<li>通过 <code>SDK</code> 提供的 <code>setApiKey(String key);</code> 接口设置 <code>Key</code>，注意 <code>Key</code> 设置要在 <code>SDK</code> 业务初始化之前。</li>
					</ol>
				</details>
				<details>
					<summary>iOS：获取逆地理信息需要高德地图配置 apiKey</summary>
					<img src="https://raw.githubusercontent.com/uiwjs/react-native-amap-geolocation/master/imgs/amapkey.png" />
				</details>
				<details>
					<summary>iOS：高德地图包需要 WiFi 权限</summary>
					<br />
					<p>iOS 端高德地图包需要 WiFi 权限，否则报如下警告：</p>
					<pre><code>nehelper sent invalid result code [<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> Wi-Fi information request</code></pre>
					<p>需要在<a href="https://developer.apple.com">开发者账号中设置 WiFi 权限</a></p>
					<img src="https://raw.githubusercontent.com/uiwjs/react-native-amap-geolocation/master/imgs/identifiers.png" />
					<p>同时需要在 Xcode 中添加 <code>Access WiFi Information</code> 能力选项</p>
					<img src="https://raw.githubusercontent.com/uiwjs/react-native-amap-geolocation/master/imgs/xcode.png" />
				</details>
				<details>
					<summary>iOS：需要保证"Background Modes"中的"Location updates"处于选中状态</summary>
					<img src="https://raw.githubusercontent.com/uiwjs/react-native-amap-geolocation/master/imgs/xcode.png" />
					<ol>
						<li>左侧目录中选中工程名，开启 <code>TARGETS</code> -&gt; <code>Capabilities</code> -&gt; <code>Background Modes</code></li>
						<li>在 <code>Background Modes</code> 中勾选 <code>Location updates</code></li>
					</ol>
				</details>
				<a href="#安装依赖" id="安装依赖" style="color: inherit; text-decoration: none;">
					<h2>安装依赖</h2>
				</a>
				<pre><code class="language-bash">yarn add @uiw/react-native-amap-geolocation
<span class="hljs-comment"># react-native version &gt;= 0.60+</span>
$ <span class="hljs-built_in">cd</span> ios &amp;&amp; pod install</code></pre>
				<a href="#基本用法" id="基本用法" style="color: inherit; text-decoration: none;">
					<h2>基本用法</h2>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { Platform } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;
<span class="hljs-keyword">import</span> AMapGeolocation <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@uiw/react-native-amap-geolocation&#x27;</span>;

<span class="hljs-keyword">let</span> apiKey = <span class="hljs-string">&#x27;&#x27;</span>;

<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;ios&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 iOS 的 apiKey&#x27;</span>;
}
<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;android&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 Android 的 apiKey&#x27;</span>;
}

<span class="hljs-comment">// 设置 高德地图 apiKey</span>
AMapGeolocation.setApiKey(apiKey);
<span class="hljs-comment">// iOS 指定所需的精度级别</span>
AMapGeolocation.setDesiredAccuracy(<span class="hljs-number">3</span>);
<span class="hljs-comment">// Android 指定所需的精度级别，可选设置，默认 高精度定位模式</span>
AMapGeolocation.setLocationMode(<span class="hljs-number">1</span>);
<span class="hljs-comment">// 定位是否返回逆地理信息</span>
AMapGeolocation.setLocatingWithReGeocode(<span class="hljs-literal">true</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentLocation</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> AMapGeolocation.getCurrentLocation();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;json:&#x27;</span>, json);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;error:&#x27;</span>, error);
  }
}</code></pre>
				<a href="#定位监听函数" id="定位监听函数" style="color: inherit; text-decoration: none;">
					<h2>定位监听函数</h2>
				</a>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> AMapGeolocation <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@uiw/react-native-amap-geolocation&#x27;</span>;

<span class="hljs-keyword">let</span> apiKey = <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;ios&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 iOS 的 apiKey&#x27;</span>;
}
<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;android&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 Android 的 apiKey&#x27;</span>;
}

<span class="hljs-comment">// 设置 高德地图 apiKey</span>
AMapGeolocation.setApiKey(apiKey);
<span class="hljs-comment">// 定位是否返回逆地理信息</span>
AMapGeolocation.setLocatingWithReGeocode(<span class="hljs-literal">true</span>);
<span class="hljs-comment">// 当设备可以正常联网时，还可以返回该定位点的对应的中国境内位置信息（包括：省、市、区/县以及详细地址）。</span>
AMapGeolocation.addLocationListener(<span class="hljs-function">(<span class="hljs-params">location</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;返回定位信息&#x27;</span>, location);
  <span class="hljs-built_in">this</span>.setState({
    <span class="hljs-attr">location</span>: <span class="hljs-built_in">JSON</span>.stringify(location, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), 
  });
});</code></pre>
				<a href="#逆地理编码" id="逆地理编码" style="color: inherit; text-decoration: none;">
					<h2>逆地理编码</h2>
				</a>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> AMapGeolocation <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@uiw/react-native-amap-geolocation&#x27;</span>;

<span class="hljs-keyword">let</span> apiKey = <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;ios&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 iOS 的 apiKey&#x27;</span>;
}
<span class="hljs-keyword">if</span> (Platform.OS === <span class="hljs-string">&#x27;android&#x27;</span>) {
  apiKey = <span class="hljs-string">&#x27;用于 Android 的 apiKey&#x27;</span>;
}

<span class="hljs-comment">// 设置 高德地图 apiKey</span>
AMapGeolocation.setApiKey(apiKey);
<span class="hljs-comment">// 定位是否返回逆地理信息</span>
AMapGeolocation.setLocatingWithReGeocode(<span class="hljs-literal">true</span>);</code></pre>
				<a href="#坐标转换" id="坐标转换" style="color: inherit; text-decoration: none;">
					<h2>坐标转换</h2>
				</a>
				<p>坐标转换，支持将iOS自带定位 GPS/Google/MapBar/Baidu/MapABC 多种坐标系的坐标转换成高德坐标</p>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> AMapGeolocation <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@uiw/react-native-amap-geolocation&#x27;</span>;

<span class="hljs-comment">// 将百度地图转换为 高德地图 经纬度</span>
<span class="hljs-keyword">const</span> resulte = <span class="hljs-keyword">await</span> AMapGeolocation.coordinateConvert({
  <span class="hljs-attr">latitude</span>: <span class="hljs-number">40.002172</span>,
  <span class="hljs-attr">longitude</span>: <span class="hljs-number">116.467357</span>,
}, <span class="hljs-number">0</span>);
<span class="hljs-comment">// =&gt; {longitude: 116.46071927031961, latitude: 39.99651501274128}</span></code></pre>
				<a href="#定位回调频率限制" id="定位回调频率限制" style="color: inherit; text-decoration: none;">
					<h2>定位回调频率限制</h2>
				</a>
				<pre><code class="language-js"><span class="hljs-keyword">import</span> AMapGeolocation <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@uiw/react-native-amap-geolocation&#x27;</span>;

<span class="hljs-comment">// android，5 秒请求一次定位</span>
AMapGeolocation.setInterval(<span class="hljs-number">5000</span>);

<span class="hljs-comment">// ios，设备移动超过 10 米才会更新位置信息</span>
AMapGeolocation.setDistanceFilter(<span class="hljs-number">10</span>);</code></pre>
				<a href="#错误处理" id="错误处理" style="color: inherit; text-decoration: none;">
					<h2>错误处理</h2>
				</a>
				<pre><code class="language-bash">[NetworkInfo] Signal strength query returned error: Error Domain=NSPOSIXErrorDomain Code=13 <span class="hljs-string">&quot;Permission denied&quot;</span>, descriptor: &lt;CTServiceDescriptor 0x283317100, domain=1, instance=1&gt;</code></pre>
				<p>在 <code>Product</code> -&gt; <code>Scheme</code> -&gt; <code>Edit Scheme</code> -&gt; <code>Run</code> -&gt; <code>Arguments</code> -&gt; <code>Environment Variables</code> 添加 <code>OS_ACTIVITY_MODE</code> <code>disable</code></p>
				<pre><code class="language-bash">nehelper sent invalid result code [1] <span class="hljs-keyword">for</span> Wi-Fi information request</code></pre>
				<p>配置 WiFi 权限</p>
				<a href="#其它" id="其它" style="color: inherit; text-decoration: none;">
					<h2>其它</h2>
				</a>
				<p>当前工程基于 <a href="https://github.com/brodybits/create-react-native-module">@brodybits/create-react-native-module</a> 初始化。</p>
				<pre><code class="language-bash">npx create-react-native-module --package-identifier com.uiwjs.react.geolocation --object-class-name RNAMapGeolocation --generate-example AMapGeolocation --example-react-native-version 0.63.0 --module-name @uiw/react-native-amap-geolocation --github-account uiwjs --author-name <span class="hljs-string">&quot;Kenny Wong&quot;</span> --author-email <span class="hljs-string">&quot;wowohoo@qq.com&quot;</span></code></pre>
				<a href="#开发" id="开发" style="color: inherit; text-decoration: none;">
					<h2>开发</h2>
				</a>
				<pre><code class="language-bash"><span class="hljs-built_in">cd</span> example   <span class="hljs-comment"># 进入实例 example 工程，根目录不需要安装，会引发错误</span>
yarn install <span class="hljs-comment"># 安装依赖</span>

<span class="hljs-built_in">cd</span> ios     <span class="hljs-comment"># 进入 example/ios 目录安装依赖</span>
pod instll <span class="hljs-comment"># 安装依赖</span></code></pre>
				<a href="#相关连接" id="相关连接" style="color: inherit; text-decoration: none;">
					<h2>相关连接</h2>
				</a>
				<ul>
					<li><a href="http://amappc.cn-hangzhou.oss-pub.aliyun-inc.com/lbs/static/unzip/Android_Location_Doc/index.html">高德地图：Android 端类文档</a></li>
					<li><a href="https://lbs.amap.com/api/ios-location-sdk/download/">高德地图：iOS定位SDK V2.6.5</a></li>
					<li><a href="https://lbs.amap.com/api/android-location-sdk/download">高德地图：Android 定位SDK V5.1.0</a></li>
					<li><a href="https://lbs.amap.com/api/ios-location-sdk/guide/create-project/idfa-guide">高德地图：提交 AppStore 必读</a></li>
				</ul>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-interface">
						<a href="interfaces/coordinates.html" class="tsd-kind-icon">Coordinates</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/point.html" class="tsd-kind-icon">Point</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/regeocode.html" class="tsd-kind-icon">Re<wbr>Geocode</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#addlocationlistener" class="tsd-kind-icon">add<wbr>Location<wbr>Listener</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#coordinateconvert" class="tsd-kind-icon">coordinate<wbr>Convert</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#getcurrentlocation" class="tsd-kind-icon">get<wbr>Current<wbr>Location</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#isstarted" class="tsd-kind-icon">is<wbr>Started</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setallowsbackgroundlocationupdates" class="tsd-kind-icon">set<wbr>Allows<wbr>Background<wbr>Location<wbr>Updates</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setapikey" class="tsd-kind-icon">set<wbr>Api<wbr>Key</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setdesiredaccuracy" class="tsd-kind-icon">set<wbr>Desired<wbr>Accuracy</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setdistancefilter" class="tsd-kind-icon">set<wbr>Distance<wbr>Filter</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setgeolanguage" class="tsd-kind-icon">set<wbr>Geo<wbr>Language</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setgpsfirst" class="tsd-kind-icon">set<wbr>Gps<wbr>First</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#sethttptimeout" class="tsd-kind-icon">set<wbr>Http<wbr>Time<wbr>Out</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setinterval" class="tsd-kind-icon">set<wbr>Interval</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setlocatingwithregeocode" class="tsd-kind-icon">set<wbr>Locating<wbr>With<wbr>ReGeocode</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setlocationcacheenable" class="tsd-kind-icon">set<wbr>Location<wbr>Cache<wbr>Enable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setlocationmode" class="tsd-kind-icon">set<wbr>Location<wbr>Mode</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setlocationprotocol" class="tsd-kind-icon">set<wbr>Location<wbr>Protocol</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setlocationtimeout" class="tsd-kind-icon">set<wbr>Location<wbr>Timeout</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setoncelocation" class="tsd-kind-icon">set<wbr>Once<wbr>Location</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setoncelocationlatest" class="tsd-kind-icon">set<wbr>Once<wbr>Location<wbr>Latest</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setpauseslocationupdatesautomatically" class="tsd-kind-icon">set<wbr>Pauses<wbr>Location<wbr>Updates<wbr>Automatically</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setregeocodetimeout" class="tsd-kind-icon">set<wbr>ReGeocode<wbr>Timeout</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setsensorenable" class="tsd-kind-icon">set<wbr>Sensor<wbr>Enable</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#setwifiscan" class="tsd-kind-icon">set<wbr>Wifi<wbr>Scan</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#start" class="tsd-kind-icon">start</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#startupdatingheading" class="tsd-kind-icon">start<wbr>Updating<wbr>Heading</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#stop" class="tsd-kind-icon">stop</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#stopupdatingheading" class="tsd-kind-icon">stop<wbr>Updating<wbr>Heading</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>